metadata:
    name: ansiblepatchmetrics
    format: "Lava-Test-Shell Test Definition 1.0"
    description: "Install linaro patchmetrics using Ansible"
params:
    blankvar: empty
run:
    steps:
        - echo "Install Dependencies"
        - apt-get install -y git-core
        - apt-get install -y python-pip python-dev
        - echo "Install Ansible"
        - pip install ansible
        - echo "Create /root/hosts"
        - . ./ansible/hosts.sh
        - echo "Create /root/host_vars"
        - . ./ansible/host_vars.sh
        - echo 'Create /root/secrets.yml file'
        - . ./ansible/secrets.sh
        - mkdir -p /srv
        - cd /srv
        - git clone https://git.linaro.org/infrastructure/linaro-patchmetrics.git
        - cd linaro-patchmetrics/ansible
        - echo "Only run local install"
        - cp /root/secrets.yml .
        - cp /root/localhost host_vars/127.0.0.1
        - ansible-playbook -c local -s -i /root/hosts site.yml -l 127.0.0.1
        
