metadata:
    name: lava-populate-server
    format: "Lava-Test-Shell Test Definition 1.0"
    description: "begin populating a lava server"
params:
    INSTANCE: production
    DEVICE_TYPE: kvm
    ADMINUSER: admin
    ADMINPASS: admin
    NUMKVMS: 2
install:
    deps:
        - git-core
        - grep
        - curl
run:
    steps:
        - export SKIP_ROOT_CHECK=yes
        - echo POPULATELAVA Add user $ADMINUSER:$ADMINPASS to instance $INSTANCE
        - ./lava/create-superuser.sh $INSTANCE $ADMINUSER $ADMINPASS
        - echo POPULATELAVA Add $NUMKVMS $DEVICE_TYPE to instance $INSTANCE
        - ./lava/add-kvm-devices.sh $INSTANCE $DEVICE_TYPE $ADMINUSER $ADMINPASS $NUMKVMS
        - echo POPULATELAVA Add some dummy devices
        - ./lava/add-dummy-devices.sh $INSTANCE $ADMINUSER $ADMINPASS host 4
        - ./lava/add-dummy-devices.sh $INSTANCE $ADMINUSER $ADMINPASS schroot 4
        - /srv/lava/instances/$INSTANCE/bin/lava dashboard make-stream --dashboard-url http://localhost/RPC2/ /anonymous/sandbox

        
