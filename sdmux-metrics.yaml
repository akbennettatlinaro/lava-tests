metadata:
    name: sdmux-metrics
    format: "Lava-Test-Shell Test Definition 1.0"
    description: "A few tests to test performance
                  of the LMP SDMux over time"
    os:
        - oe
    devices:
        - beagleboneblack-sdmux
    scope:
        - functional

run:
    steps:
        - echo THISISATEST
        - "start=`date +\"%s\"`"
        - dd if=/dev/urandom of=/tmpfile bs=1M count=100
        - "echo LAVA__100MB-write: $((`date +\"%s\"`-start))"
        - "echo LAVA__mmcblk0-size: `cat /sys/block/mmcblk0/size`"
        - "echo LAVA__mmcblk0p1-size: `cat /sys/block/mmcblk0/mmcblk0p1/size`"
        - "echo LAVA__mmcblk0p2-size: `cat /sys/block/mmcblk0/mmcblk0p2/size`"
        - "echo LAVA__mmcblk1-size: `cat /sys/block/mmcblk1/size`"
        - "echo LAVA__mmcblk1p1-size: `cat /sys/block/mmcblk1/mmcblk1p1/size`"
        - "echo LAVA__mmcblk1p2-size: `cat /sys/block/mmcblk1/mmcblk1p2/size`"
        - cp -avr fio/armhf/* /
        - iozone/iozone -a -g 1024 -+n -y 64 -q 256 -b output.xls
        - lava-test-case-attach test-attach output.xls application/xls
        - fio --name=LAVA__randwrite-avg-bandwidth --rw=randwrite -- size=64m --minimal |cut -d";" -f3,86
        - fio --name=LAVA__randwrite-min-bandwidth --rw=randwrite -- size=64m --minimal |cut -d";" -f3,83
        - fio --name=LAVA__randwrite-max-bandwidth --rw=randwrite -- size=64m --minimal |cut -d";" -f3,84
        - fio --name=LAVA__randwrite-cpu-usage --rw=randwrite -- size=64m --minimal |cut -d";" -f3,88


parse:
    pattern: "^LAVA__(?P<test_case_id>[a-zA-Z0-9_\\-/]+):\\s+(?P<measurement>[a-zA-Z\\-]+)"
    
